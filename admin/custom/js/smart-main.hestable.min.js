function doFirst(){
	lnklog = document.getElementById("lnklog");
	txtemail = document.getElementById("email");
	txtpassword = document.getElementById("password");
	frm_login = document.getElementById("frm_login");
	lnklog.addEventListener('click', attempt_login, false); 
	 
}

function getDetails(){
//	alert('yoh');
	lnkadd= document.getElementById("lnkadd");
	this_name= document.getElementById("user_name");
	biz_name= document.getElementById("biz_name");
	phone= document.getElementById("phone");
	residence= document.getElementById("residence");
	this_email= document.getElementById("this_email");
	this_password= document.getElementById("this_password");
	confirm_password= document.getElementById("confirm_password");

	var nameValue=this_name.value;
	var bizValue=biz_name.value;
	var residenceValue=residence.value;
	var emailValue=this_email.value;
	var passwordvalue=this_password.value;
	var confirmValue=confirm_password.value;
	var phoneValue=phone.value;
	
	if(passwordvalue==confirmValue){

			$("#loading_point").html("<div role='alert' class='alert alert-warning margin-top-30'><strong>Working!</strong>Loading, please wait...</div>");
		registerFxn(nameValue,bizValue,residenceValue,emailValue,passwordvalue,phoneValue);
	}else{
	
		$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong>Password does not match!!!</div>");
	}
}


function reset_password(){
	email = document.getElementById("tb_email").value;
	mobile = document.getElementById("tb_mobile").value;
	var response;
	var base_url = './data/apis/account-reset.php?email=' + email + '&mobile='+ mobile;
	var form_data = {
		success: 'success',
		message: 'message'
	};
	
	$.ajax({
		type: "GET", 
		url: base_url, 
		dataType : "json",
		data: form_data,
		success: function(response)
		{
			if(response["resultvalue"][0].success == 1){
				swal('Success', response["resultvalue"][0].message, 'success');
			}else{
				swal('Failed', response["resultvalue"][0].message, 'error');
			}
		}  
	}); 	
}

function attempt_login2(){
	var emailvalue = txtemail.value;
	var passwordvalue = txtpassword.value;
	if(emailvalue == "" || passwordvalue == ""){
		$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong> Login Failed missing details.</div>");
	}else{
		$("#loading_point").html("<div role='alert' class='alert alert-warning margin-top-30'><strong>Working!</strong> Loading, Please wait...</div>");
		loginFxN(emailvalue, passwordvalue);
	}
}
function attempt_login (e){
	var emailvalue = txtemail.value;
	var passwordvalue = txtpassword.value;
	if(emailvalue == "" || passwordvalue == ""){
		$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong> Login Failed missing details.</div>");
	}else{
		$("#loading_point").html("<div role='alert' class='alert alert-warning margin-top-30'><strong>Working!</strong> Loading, Please wait...</div>");
		loginFxN(emailvalue, passwordvalue);
	}
}

// function attempt_registration(e){
// 	var nameValue=name.value;
// 	var bizValue=biz_name.value;
// 	var residenceValue=residence.value;
// 	var emailValue=email.value;
// 	var passwordvalue=password.value;
// 	var confirmValue=confirmValue.value;
// 	var phoneValue=phoneValue.value;
	
// 	if(passwordvalue===confirmValue){
// 		$("#loading_point").html("<div role='alert' class='alert alert-warning margin-top-30'><strong>Failed!</strong>Loading, please wait...</div>");
// 		registerFxn(nameValue,bizValue,residenceValue,emailValue,passwordvalue,phoneValue);
// 	}else{
// 		$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong>Password does not match!!!</div>");
// 	}

// }

function registerFxn(nameValue,biz,residence,email,password,phoneValue){
	
	var response;
	var value1='name='+nameValue+'&biz='+biz+'&residence='+residence+'&email='+email+'&password='+password+'&phoneValue='+phoneValue;
	var base_url = './data/apis/log/register.php?'+value1;
	var form_data = {
		success: 'success',
		message: 'message',
		userid: 'message'
	};
	
	$.ajax({
		type: "GET", 
		url: base_url, 
		dataType : "json",
		data: form_data,
		success: function(response)
		{
			if(response["resultvalue"][0].success == 1){
				attempt_redirect('./data/auth.php?userid=' + response["resultvalue"][0].message);
			}else{
				$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong> Login Failed wrong details.</div>");
			}
		}  
	}); 
}


function loginFxN(emailvalue, passwordvalue){
	//alert(emailvalue + ' ' + passwordvalue);
	var response;
	var base_url = './data/log.php?email=' + emailvalue + '&password='+ passwordvalue;
	var form_data = {
		success: 'success',
		message: 'message',
		userid: 'message'
	};
	
	$.ajax({
		type: "GET", 
		url: base_url, 
		dataType : "json",
		data: form_data,
		success: function(response)
		{
			if(response["resultvalue"][0].success == 1){
				attempt_redirect('./data/auth.php?userid=' + response["resultvalue"][0].message);
			}else{
				$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong> Login Failed wrong details.</div>");
			}
		}  
	}); 
}

function attempt_redirect(path){
	var promise=Smartjax.ajax({
		url: path,
		data:{ },
		type: 'POST',
		force:true,
		store: false,
	});
	promise.then(function (apiResult) {
		$("#frm_login").html("");
		$("#loading_point").html("<div role='alert' class='alert alert-success margin-top-30'><strong>Success!</strong> Login Success, System will redirect you shortly...</div>");
		window.location = "./";
	},function(){
		$("#loading_point").html("<div role='alert' class='alert alert-danger margin-top-30'><strong>Failed!</strong> Redirect failed.</div>");
	})
}
window.addEventListener('load', doFirst, false);